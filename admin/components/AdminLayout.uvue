<template>
  <view class="admin-layout">
    <!-- å·¦ä¾§ä¾§è¾¹æ  -->
    <view class="sidebar">
      <view class="logo-area">
        <text class="logo-icon">âš¡ï¸</text>
        <text class="logo-text">ç®¡ç†åå°</text>
      </view>
      
      <view class="nav-menu">
        <view 
          class="nav-item" 
          :class="{ active: currentPath === 'dashboard' }"
          @click="switchPage('dashboard')"
        >
          <text class="nav-icon">ğŸ“Š</text>
          <text class="nav-text">ç³»ç»Ÿæ¦‚è§ˆ</text>
        </view>
        <view 
          class="nav-item" 
          :class="{ active: currentPath === 'user' }"
          @click="switchPage('user')"
        >
          <text class="nav-icon">ğŸ‘¥</text>
          <text class="nav-text">ç”¨æˆ·ç®¡ç†</text>
        </view>
        <view 
          class="nav-item" 
          :class="{ active: currentPath === 'content' }"
          @click="switchPage('content')"
        >
          <text class="nav-icon">ğŸ“</text>
          <text class="nav-text">å†…å®¹ç®¡ç†</text>
        </view>
      </view>
    </view>

    <!-- å³ä¾§ä¸»ä½“å†…å®¹ -->
    <view class="main-container">
      <!-- é¡¶éƒ¨ Header -->
      <view class="header">
        <view class="breadcrumb">
          <text class="page-title">{{ getPageName() }}</text>
        </view>
        <view class="user-area">
          <text class="username">ç®¡ç†å‘˜</text>
          <view class="btn-logout" @click="handleLogout">
            <text>é€€å‡º</text>
          </view>
        </view>
      </view>

      <!-- å†…å®¹åŒºåŸŸ -->
      <scroll-view class="content-scroll" scroll-y>
        <view class="page-content">
          <slot></slot>
        </view>
      </scroll-view>
    </view>
  </view>
</template>

<script setup>
  import { defineProps } from 'vue'

  const props = defineProps({
    currentPath: {
      type: String,
      default: 'dashboard'
    }
  })

  const switchPage = (path) => {
    if (path === props.currentPath) return
    
    let url = ''
    switch (path) {
      case 'dashboard':
        url = '/admin/pages/dashboard/dashboard'
        break
      case 'user':
        url = '/admin/pages/user/user'
        break
      case 'content':
        url = '/admin/pages/content/content'
        break
    }
    uni.reLaunch({ url })
  }

  const getPageName = () => {
    const map = {
      'dashboard': 'ç³»ç»Ÿæ¦‚è§ˆ',
      'user': 'ç”¨æˆ·ç®¡ç†',
      'content': 'å†…å®¹ç®¡ç†'
    }
    return map[props.currentPath] || 'åå°ç®¡ç†'
  }

  const handleLogout = () => {
    uni.showModal({
      title: 'ç¡®è®¤é€€å‡º',
      content: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          uni.removeStorageSync('adminToken')
          uni.removeStorageSync('adminUser')
          uni.reLaunch({ url: '/admin/pages/login/login' })
        }
      }
    })
  }
</script>

<style scoped>
  /* Apple é£æ ¼å¸ƒå±€é‡æ„ */
  .admin-layout {
    display: flex;
    width: 100vw;
    height: 100vh;
    background-color: #f5f5f7; /* Apple æµ…ç°èƒŒæ™¯ */
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  /* ä¾§è¾¹æ ï¼šæ¯›ç»ç’ƒæ•ˆæœ + å“åº”å¼ */
  .sidebar {
    width: 280px;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-right: 1px solid rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
  }

  /* ç§»åŠ¨ç«¯ä¾§è¾¹æ é€‚é… */
  @media (max-width: 768px) {
    .sidebar {
      position: absolute;
      transform: translateX(-100%);
      width: 240px;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.95);
    }
    
    .sidebar.open {
      transform: translateX(0);
    }
  }

  .logo-area {
    height: 80px;
    display: flex;
    align-items: center;
    padding: 0 32px;
    background-color: transparent;
  }

  .logo-text {
    font-size: 20px;
    font-weight: 600;
    color: #1d1d1f;
    letter-spacing: -0.5px;
  }

  .nav-menu {
    flex: 1;
    padding: 20px 16px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    height: 44px;
    padding: 0 16px;
    margin-bottom: 4px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: #86868b;
  }

  .nav-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
    color: #1d1d1f;
  }

  .nav-item.active {
    background-color: #0071e3;
    color: #fff;
  }

  .nav-icon {
    margin-right: 12px;
    font-size: 18px;
  }

  .nav-text {
    font-size: 15px;
    font-weight: 500;
  }

  /* ä¸»ä½“åŒºåŸŸ */
  .main-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    height: 100vh; /* å¼ºåˆ¶å æ»¡é«˜åº¦ */
    min-width: 0; /* é˜²æ­¢ flex å­é¡¹æº¢å‡º */
  }

  .header {
    height: 60px;
    background-color: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    flex-shrink: 0;
  }

  .page-title {
    font-size: 24px;
    font-weight: 600;
    color: #1d1d1f;
    letter-spacing: -0.5px;
  }

  .user-area {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .username {
    font-size: 14px;
    color: #1d1d1f;
    font-weight: 500;
  }

  .btn-logout {
    font-size: 13px;
    color: #0071e3;
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 14px;
    background-color: rgba(0, 113, 227, 0.1);
    transition: all 0.2s;
  }
  
  .btn-logout:hover {
    background-color: rgba(0, 113, 227, 0.2);
  }

  /* å†…å®¹åŒºåŸŸæ»šåŠ¨ */
  .content-scroll {
    flex: 1;
    height: 0;
  }

  .page-content {
    padding: 32px;
    max-width: 1200px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  @media (max-width: 768px) {
    .page-content {
      padding: 16px;
    }
    
    .header {
      padding: 0 16px;
    }
  }
</style>