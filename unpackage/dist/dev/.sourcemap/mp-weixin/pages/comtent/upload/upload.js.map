{"version":3,"file":"upload.js","sources":["pages/comtent/upload/upload.uvue","../../HBuilder/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tdGVudC91cGxvYWQvdXBsb2FkLnV2dWU"],"sourcesContent":["<template>\n  <view class=\"upload-container\">\n    <!-- Ê†áÈ¢ò -->\n    <view class=\"form-item\">\n      <text class=\"label\">Ê†áÈ¢ò *</text>\n      <input\n        v-model=\"formData.title\"\n        placeholder=\"ËØ∑ËæìÂÖ•Ê†áÈ¢òÔºàÊúÄÂ§ö30Â≠óÔºâ\"\n        maxlength=\"30\"\n        class=\"input\"\n      />\n    </view>\n\n    <!-- ÊèèËø∞ -->\n    <view class=\"form-item\">\n      <text class=\"label\">ÊèèËø∞ÔºàÂèØÈÄâÔºâ</text>\n      <textarea\n        v-model=\"formData.description\"\n        placeholder=\"ËØ∑ËæìÂÖ•ÊèèËø∞ÊñáÂ≠ó...\"\n        maxlength=\"500\"\n        class=\"textarea\"\n      />\n    </view>\n\n    <!-- Ê†áÁ≠æ -->\n    <view class=\"form-item\">\n      <text class=\"label\">Ê†áÁ≠æÔºàÈÄóÂè∑ÂàÜÈöîÔºâ</text>\n      <input\n        v-model=\"rawTags\"\n        placeholder=\"Â¶ÇÔºöÁæéÈ£ü,ÊóÖË°å,Êó•Â∏∏\"\n        class=\"input\"\n      />\n    </view>\n\n    <!-- ÂÜÖÂÆπÁ±ªÂûãÈÄâÊã© -->\n    <view class=\"form-item\">\n      <text class=\"label\">ÂÜÖÂÆπÁ±ªÂûã *</text>\n      <view class=\"type-selector\">\n        <button\n          :class=\"{ active: formData.type === 'text' }\"\n          @click=\"setContentType('text')\"\n        >\n          Á∫ØÊñáÊú¨\n        </button>\n        <button\n          :class=\"{ active: formData.type === 'image' }\"\n          @click=\"setContentType('image')\"\n        >\n          ÂõæÁâá\n        </button>\n        <button\n          :class=\"{ active: formData.type === 'video' }\"\n          @click=\"setContentType('video')\"\n        >\n          ËßÜÈ¢ë\n        </button>\n      </view>\n    </view>\n\n    <!-- Â™í‰Ωì‰∏ä‰º†Âå∫Âüü -->\n    <view v-if=\"formData.type !== 'text'\" class=\"media-upload\">\n      <button @click=\"selectMedia\" class=\"upload-btn\">\n        {{ formData.type === 'image' ? 'ÈÄâÊã©ÂõæÁâá' : 'ÈÄâÊã©ËßÜÈ¢ë' }}\n      </button>\n\n      <!-- È¢ÑËßà -->\n      <view v-if=\"previewUrl\" class=\"preview\">\n        <image\n          v-if=\"formData.type === 'image'\"\n          :src=\"previewUrl\"\n          mode=\"aspectFit\"\n          class=\"preview-media\"\n        />\n        <video\n          v-else-if=\"formData.type === 'video'\"\n          :src=\"previewUrl\"\n          controls\n          class=\"preview-media\"\n        ></video>\n      </view>\n\n      <text v-if=\"mediaError\" class=\"error\">{{ mediaError }}</text>\n    </view>\n\n    <!-- Êèê‰∫§ÊåâÈíÆ -->\n    <button @click=\"submitPost\" :disabled=\"isSubmitting\" class=\"submit-btn\">\n      {{ isSubmitting ? 'ÂèëÂ∏É‰∏≠...' : 'ÂèëÂ∏ÉÂÜÖÂÆπ' }}\n    </button>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\n// ‚úÖ ÂÖ®Â±ÄÂèØÁî®ÔºåÊó†ÈúÄ import\nconst formData = ref({\n  title: '',\n  description: '',\n  type: 'text',\n  mediaLocalPath: '',\n  mediaUrl: '',\r\n  tags: [] as string[]\n})\n\nconst rawTags = ref('')\nconst previewUrl = ref('')\nconst mediaError = ref('')\nconst isSubmitting = ref(false)\n\n// Ëá™Âä®Â§ÑÁêÜÊ†áÁ≠æ\nwatch(() => rawTags.value, (newVal) => {\n  if (!newVal) {\n    formData.value.tags = []\n    return\n  }\n  const tags = newVal\n    .split(',')\n    .map(t => t.trim())\n    .filter(t => t)\n    .slice(0, 5)\n  formData.value.tags = [...new Set(tags)]\n})\n\nfunction setContentType(type: string) {\n  formData.value.type = type\n  formData.value.mediaLocalPath = ''\n  formData.value.mediaUrl = ''\n  previewUrl.value = ''\n  mediaError.value = ''\n}\n\nasync function selectMedia() {\n  try {\n    mediaError.value = ''\n\n    if (formData.value.type === 'image') {\n      // ‚úÖ ‰ΩøÁî® uni.chooseImageÔºàÊîØÊåÅÔºâ\n      const res = await uni.chooseImage({ count: 1, sizeType: ['compressed'] })\n      if (res.tempFilePaths.length === 0) return\n\n      const tempPath = res.tempFilePaths[0]\n      previewUrl.value = tempPath\n      formData.value.mediaLocalPath = tempPath\n\n    } else if (formData.value.type === 'video') {\n      // ‚úÖ ‰ΩøÁî® uni.chooseVideoÔºàÊîØÊåÅÔºâ\n      const res = await uni.chooseVideo({\n        maxDuration: 60,\n        camera: 'back'\n      })\n\n      if (res.duration > 60) {\n        mediaError.value = 'ËßÜÈ¢ëÊó∂Èïø‰∏çËÉΩË∂ÖËøá60Áßí'\n        return\n      }\n\n      previewUrl.value = res.tempFilePath\n      formData.value.mediaLocalPath = res.tempFilePath\n    }\n  } catch (err) {\n    uni.__f__('error','at pages/comtent/upload/upload.uvue:159','ÈÄâÊã©Â™í‰ΩìÂ§±Ë¥•:', err)\n    mediaError.value = 'ÈÄâÊã©Â§±Ë¥•ÔºåËØ∑ÈáçËØï'\n  }\n}\n\n// ‚úÖ Áõ¥Êé•‰∏ä‰º†Ôºå‰∏çÂÜçÂéãÁº©\nasync function uploadToAliyun(localPath: string, fileType: string): Promise<string> {\n  const timestamp = Date.now()\n  const extMatch = localPath.match(/\\.([^.]+)$/i)\n  const ext = extMatch ? extMatch[1].toLowerCase() : 'jpg'\n\n  const userId = 'anonymous'\n  const cloudPath = `posts/${fileType}/${userId}_${timestamp}.${ext}`\n\n  try {\n    const res = await uniCloud.uploadFile({\n      filePath: localPath,\n      cloudPath: cloudPath,\n      onUploadProgress(progressEvent) {\n        const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total)\n        uni.__f__('log','at pages/comtent/upload/upload.uvue:179','‰∏ä‰º†ËøõÂ∫¶:', percent + '%')\n      }\n    })\n\n    if (res.fileID) {\n      return res.fileID // ËøîÂõû CDN URL\n    } else {\n      throw new Error(res.errorMessage || '‰∏ä‰º†Â§±Ë¥•')\n    }\n  } catch (err) {\n    uni.__f__('error','at pages/comtent/upload/upload.uvue:189','‰∏ä‰º†Â§±Ë¥•:', err)\n    throw new Error('ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï')\n  }\n}\n\nasync function submitPost() {\n  if (!formData.value.title.trim()) {\n    uni.showToast({ title: 'ËØ∑ËæìÂÖ•Ê†áÈ¢ò', icon: 'none' })\n    return\n  }\n\n  if (formData.value.type !== 'text' && !formData.value.mediaLocalPath) {\n    uni.showToast({ title: 'ËØ∑‰∏ä‰º†Â™í‰ΩìÊñá‰ª∂', icon: 'none' })\n    return\n  }\n\n  isSubmitting.value = true\n\n  try {\n    let mediaUrl = ''\n\n    if (formData.value.type !== 'text') {\n      mediaUrl = await uploadToAliyun(\n        formData.value.mediaLocalPath,\n        formData.value.type\n      )\n    }\n\n    const postData = {\n      title: formData.value.title.trim(),\n      description: formData.value.description.trim(),\n      type: formData.value.type,\n      mediaUrl: mediaUrl,\n      tags: formData.value.tags\n    }\n\n    // üëá„ÄêÈúÄË¶ÅÂêéÁ´Ø API„ÄëÔºöÂèëÂ∏ÉÂÜÖÂÆπÂà∞‰Ω†ÁöÑÊúçÂä°Âô®\n    /*\n    const response = await uni.request({\n      url: 'https://your-api.com/posts/create',\n      method: 'POST',\n      data: postData\n    })\n\n    if (response.statusCode === 200) {\n      uni.showToast({ title: 'ÂèëÂ∏ÉÊàêÂäüÔºÅ', icon: 'success' })\n      setTimeout(() => uni.navigateBack(), 1500)\n    } else {\n      throw new Error('ÂèëÂ∏ÉÂ§±Ë¥•')\n    }\n    */\n\n    // ‚úÖ Ê®°ÊãüÊàêÂäü\n    uni.__f__('log','at pages/comtent/upload/upload.uvue:242','‚úÖ Ê®°ÊãüÂèëÂ∏ÉÊàêÂäü:', postData)\n    uni.showToast({ title: 'ÂèëÂ∏ÉÊàêÂäüÔºÅ', icon: 'success' })\n    setTimeout(() => uni.navigateBack(), 1500)\n\n  } catch (err) {\n    uni.__f__('error','at pages/comtent/upload/upload.uvue:247','ÂèëÂ∏ÉÂ§±Ë¥•:', err)\n    uni.showToast({ title: err.message || 'ÂèëÂ∏ÉÂ§±Ë¥•', icon: 'none' })\n  } finally {\n    isSubmitting.value = false\n  }\n}\n</script>\n\n<style scoped>\n/* Ê†∑Âºè‰øùÊåÅ‰∏çÂèò */\n.upload-container {\n  padding: 30rpx;\n  background-color: #f8f9fa;\n  min-height: 100vh;\n}\n\n.form-item {\n  margin-bottom: 40rpx;\n}\n\n.label {\n  display: block;\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 16rpx;\n  font-weight: bold;\n}\n\n.input {\n  width: 100%;\n  padding: 20rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  background: white;\n}\n\n.textarea {\n  width: 100%;\n  height: 200rpx;\n  padding: 20rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  background: white;\n  line-height: 1.5;\n}\n\n.type-selector {\n  display: flex;\n  gap: 20rpx;\n}\n\n.type-selector button {\n  flex: 1;\n  padding: 16rpx 0;\n  font-size: 26rpx;\n  background-color: #f0f0f0;\n  color: #333;\n  border-radius: 12rpx;\n}\n\n.type-selector button.active {\n  background-color: #007aff;\n  color: white;\n}\n\n.media-upload {\n  margin-top: 20rpx;\n}\n\n.upload-btn {\n  background-color: #007aff;\n  color: white;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n}\n\n.preview {\n  margin-top: 20rpx;\n  text-align: center;\n}\n\n.preview-media {\n  width: 100%;\n  height: 400rpx;\n  background-color: #eee;\n  border-radius: 12rpx;\n}\n\n.error {\n  color: red;\n  font-size: 24rpx;\n  margin-top: 10rpx;\n  display: block;\n}\n\n.submit-btn {\n  width: 100%;\n  padding: 24rpx;\n  background-color: #007aff;\n  color: white;\n  font-size: 32rpx;\n  border-radius: 16rpx;\n  margin-top: 60rpx;\n}\n\n.submit-btn:disabled {\n  background-color: #ccc;\n}\n</style>","import MiniProgramPage from 'D:/HBuilder-code/-/pages/comtent/upload/upload.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","watch","uni","uniCloud"],"mappings":"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"}